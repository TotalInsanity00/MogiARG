<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Password</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            color: #fff;
            font-family: Georgia, serif;
            overflow: hidden;
        }

        #panel {
            text-align: center;
            z-index: 2
        }

        #panel h1 {
            font-size: 2rem;
            margin: 0
        }

        #nameInput {
            margin-top: 18px;
            padding: 10px 12px;
            font-size: 1rem;
            border-radius: 6px;
            border: none;
            outline: none;
        }

        #enterBtn {
            margin-top: 12px;
            padding: 9px 14px;
            font-size: 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }

        #overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity .1s ease;
            z-index: 50;
        }

        #overlay.show {
            opacity: 1;
            pointer-events: auto
        }

        #overlay::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url("src/glass.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            opacity: 0.95;
            mix-blend-mode: screen;
        }

        #revealMsg {
            position: relative;
            z-index: 2;
            font-size: 2rem;
            text-align: center;
            white-space: pre-wrap;
            padding: 12px 18px;
            border-radius: 8px;
            transform: translateY(-8px);
        }

        @keyframes shake {
            0% {
                transform: translateX(0)
            }

            20% {
                transform: translateX(-6px)
            }

            40% {
                transform: translateX(6px)
            }

            60% {
                transform: translateX(-4px)
            }

            80% {
                transform: translateX(4px)
            }

            100% {
                transform: translateX(0)
            }
        }

        #revealMsg.shake {
            animation: shake .6s ease 0s 1
        }
    </style>
</head>

<body>

    <div id="panel">
        <h1>What is thy name?</h1>
        <input id="nameInput" type="text" autocomplete="off" placeholder="Enter thy name..." />
        <br />
        <button id="enterBtn">Enter</button>
    </div>

    <div id="overlay" aria-hidden="true">
        <div id="revealMsg">ACCESS GRANTED</div>
    </div>

    <script>
        const correctHash = "3c38aafb0579dafe18bb584dce2786ccaab6835245f2979af4bb7dd2b6b90775";
        const messageHash = "c839bfbd180b07607437986b1dc093b339996fdf49f35841f98029f6bc7259cf";

        const obf = [
            "l1mL",
            "z9mb",
            "yVGd",
            "h5ib",
            "pZmZ",
            "11Wa",
            "n9Wb"
        ];

        async function sha256(message) {
            const msg = new TextEncoder().encode(String(message));
            const buf = await crypto.subtle.digest("SHA-256", msg);
            const arr = Array.from(new Uint8Array(buf));
            return arr.map(b => b.toString(16).padStart(2, "0")).join("");
        }

        function normalizeInput(s) {
            return String(s || "").toLowerCase().trim();
        }

        function revealObfuscatedSecret() {
            try {
                const base64 = obf.slice().reverse().map(ch => ch.split("").reverse().join("")).join("");
                const secret = atob(base64);
                return secret;
            } catch (e) {
                return null;
            }
        }

        const inputEl = document.getElementById("nameInput");
        const btn = document.getElementById("enterBtn");
        const overlay = document.getElementById("overlay");
        const revealMsg = document.getElementById("revealMsg");

        async function checkName() {
            const raw = inputEl.value;
            const normalized = normalizeInput(raw);
            if (!normalized) { alert("Please enter a name."); return; }

            const hash = await sha256(normalized);

            if (hash === correctHash) {
                const secret = revealObfuscatedSecret();
                if (!secret) {
                    alert("Could not recover secret (data tampered).");
                    return;
                }
                const verify = await sha256(secret);
                if (verify !== messageHash) {
                    alert("Integrity check failed.");
                    return;
                }

                revealMsg.textContent = secret;
                overlay.classList.add("show");
                const audio = new Audio('src/crack.mp3');
                audio.volume = 0.1;
                audio.play();
                setTimeout(() => revealMsg.classList.add("shake"), 80);

            } else {
                alert("Incorrect.");
            }
        }

        btn.addEventListener("click", checkName);
        inputEl.addEventListener("keydown", (e) => { if (e.key === "Enter") checkName(); });

        window.addEventListener("load", () => inputEl.focus());
    </script>

</body>

</html>